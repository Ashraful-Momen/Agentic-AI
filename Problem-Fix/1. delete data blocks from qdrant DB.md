# Qdrant Index Block Form Deletion Process

## Overview
This document outlines the step-by-step process to delete index block form collections from Qdrant running at http://127.0.0.1:6333/ and remove all backup data from storage.

## Prerequisites
- Docker installed and running
- Qdrant container running on port 6333
- Access to Qdrant storage directory: `/home/ashraful/Software/qdrant_storage/qdrant_storage/`

## Step 1: Check Existing Collections via API
```bash
# List all collections in Qdrant
curl -X GET "http://127.0.0.1:6333/collections" | jq .
```

## Step 2: Delete Collections via API
```bash
# Delete collection 1 (replace with actual collection name)
curl -X DELETE "http://127.0.0.1:6333/collections/ws-708a0a647c55fac5" | jq .

# Delete collection 2 (replace with actual collection name)
curl -X DELETE "http://127.0.0.1:6333/collections/ws-7fcc8bd69c4a11c2" | jq .

# Delete collection 3 (replace with actual collection name)
curl -X DELETE "http://127.0.0.1:6333/collections/ws-d498027c9e7b233d" | jq .
```

## Step 3: Verify Collections are Deleted via API
```bash
# Verify no collections exist
curl -X GET "http://127.0.0.1:6333/collections" | jq .

# Verify no aliases exist
curl -X GET "http://127.0.0.1:6333/aliases" | jq .
```

## Step 4: Remove Backup Data from Storage
```bash
# Check Qdrant container volume mount
docker inspect qdrant-db | grep -A 10 -B 5 "Mounts"

# Navigate to storage directory
cd /home/ashraful/Software/qdrant_storage/qdrant_storage/

# Remove all collection data (requires sudo if files are owned by root)
sudo rm -rf collections/*

# Or check ownership first
ls -la collections/
```

## Step 5: Restart Qdrant Container
```bash
# Restart the container to clear in-memory data
docker restart qdrant-db

# Wait for container to fully restart
sleep 5
```

## Step 6: Final Verification
```bash
# Verify collections are empty after restart
curl -X GET "http://127.0.0.1:6333/collections" | jq .

# Verify aliases are empty
curl -X GET "http://127.0.0.1:6333/aliases" | jq .
```

## Step 7: Check Storage Directory
```bash
# Verify collections directory is empty
ls -la /home/ashraful/Software/qdrant_storage/qdrant_storage/collections/

# Check for any remaining files
find /home/ashraful/Software/qdrant_storage/qdrant_storage/ -type f
```

## Additional Commands for Troubleshooting

### Check Container Status
```bash
# Check if Qdrant container is running
docker ps | grep qdrant

# Check container logs
docker logs qdrant-db
```

### Force Remove All Data (if needed)
```bash
# Stop Qdrant container
docker stop qdrant-db

# Remove all data from storage
sudo rm -rf /home/ashraful/Software/qdrant_storage/qdrant_storage/*

# Start Qdrant container
docker start qdrant-db
```

## Notes
- Collections in Qdrant persist even after API deletion until storage is cleared
- The storage directory contains WAL (Write-Ahead Log) files that may retain data
- Restarting the container ensures all in-memory data is flushed
- Always verify both API and storage levels for complete deletion

## Execution Date
November 24, 2025

## Collections Deleted
1. ws-708a0a647c55fac5 (2041 points)
2. ws-7fcc8bd69c4a11c2 (207 points)
3. ws-d498027c9e7b233d (points count unknown)

## Storage Location
Primary: `/home/ashraful/Software/qdrant_storage/qdrant_storage/`
Container Mount: `/qdrant/storage`

## Important Note About Indexing Status

### Issue: Persistent Block Count After Collection Deletion

Even after successfully deleting all collections from Qdrant, you may still see indexing status like:
```
Status: Indexing - Indexed 120 / 6912 blocks found
```

### Why This Happens

This indicates that there's likely another application or service separate from Qdrant that:
1. Has its own indexing system independent of Qdrant
2. Is caching block information in a different database or storage
3. Has a separate block metadata tracking system

### Possible Sources of Indexing Status

1. **Codeium Extension**: Running with `--enable_index_service` flag
   - Database: `/home/ashraful/.codeium/database/`
   - May be indexing project files independently

2. **Separate Indexing Application**:
   - Could be a web interface on port 9000
   - May have its own database for block tracking

3. **IDE/Editor Plugin**:
   - VSCode extensions or other editor plugins
   - Local search indexing services

### Additional Investigation Steps

To find the source of the indexing status:

```bash
# Check for running indexing services
ps aux | grep -i index

# Check for applications on common ports
netstat -tlnp | grep -E ":(3000|8000|8080|9000|5173|4173)"

# Look for configuration files
find . -name "*.json" -o -name "*.config" | xargs grep -l "6912\|blocks.*found" 2>/dev/null

# Check for log files
find . -name "*.log" | xargs grep -l "Indexed.*120\|6912" 2>/dev/null
```

### Complete Cleanup Required

To fully remove block indexing, you may need to:

1. Delete Qdrant collections (completed)
2. Clear Qdrant storage (completed)
3. **Identify and stop the separate indexing service**
4. Clear the indexing service's database/cache
5. Restart the indexing application

### Recommendation

The indexing status "Indexed 120 / 6912 blocks found" is likely coming from an application separate from Qdrant. You'll need to identify which application is showing this status and clear its data separately from the Qdrant cleanup process documented above.
